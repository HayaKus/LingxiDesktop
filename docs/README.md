# 灵析 (Lingxi) - 桌面AI助手

> 一个具备屏幕感知能力的可爱桌面AI助手

**项目状态**：✅ MVP 已完成
**创建时间**：2026-01-08
**负责人**：哈雅（263321）
**版本**：v0.1.0

---

## 📖 项目简介

灵析（Lingxi）是一个创新的桌面AI助手，以可爱的金毛犬形象出现在用户桌面上。它的核心创新在于**屏幕感知能力** - AI能够"看到"用户的屏幕内容,从而提供更智能、更贴合场景的辅助。

### 核心特性

🐕 **可爱的桌面宠物**
- 金毛犬形象
- 静态图标,简洁友好
- 左键点击打开对话,长按拖动位置
- 初始位置在屏幕右下角
- 可自由拖动到任意位置

👁️ **屏幕感知能力**
- 智能窗口截图(自动识别当前活跃窗口)
- 理解用户当前屏幕内容
- 基于视觉上下文回答问题
- 支持粘贴板截图识别
- 支持同时发送多张图片
- 图片自动压缩优化(50%缩放 + JPEG 80%质量)

💬 **智能对话交互**
- 点击宠物或快捷键（Cmd+Shift+0）唤醒
- 对话窗口智能定位(图标上方)
- 自动聚焦输入框
- 支持多轮对话记忆
- Markdown格式回答,代码高亮
- 流式响应,实时显示
- 多会话管理(支持创建多个独立会话)
- 会话历史持久化存储

🔐 **企业级认证**
- 支持BUC登录认证
- API密钥本地加密存储
- 用户信息自动获取

⚙️ **智能上下文管理**
- 动态Token计算和优化
- 优先移除图片策略(保留更长对话历史)
- 自适应各种对话场景
- 智能裁剪,用户无感知

🔒 **隐私友好**
- 按需截图,用户完全可控
- 不做主动监控
- 会话数据本地存储
- 自动保存管理

---

## 🎯 使用场景

### 1. 文档理解
**场景**：用户正在阅读技术文档或产品说明
- 询问："这个API怎么用？"
- AI看到文档内容,提供针对性的使用示例

### 2. 学习辅助
**场景**：用户正在学习教程或新技术
- 询问："这个概念我不太理解,能解释一下吗？"
- AI结合屏幕内容提供详细解释

### 3. 代码开发辅助
**场景**：用户正在编写代码遇到问题
- 询问："这段代码有什么问题？"
- AI分析代码截图,提供修改建议

### 4. 多会话管理
**场景**：用户需要同时处理多个不同的话题
- 创建多个独立会话
- 每个会话保持独立的对话历史
- 随时切换和管理会话

---

## 🚀 快速开始

### 系统要求
- macOS 10.15+
- 屏幕录制权限
- 粘贴板访问权限

### 安装使用

#### 开发模式
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 在另一个终端启动 Electron
npm run electron:dev
```

#### 生产模式(推荐)
```bash
# 构建并打包
npm run build
npm run electron:build

# 安装应用
# 方式1：直接运行
open release/mac-arm64/灵析.app

# 方式2：安装到应用程序文件夹
cp -r release/mac-arm64/灵析.app /Applications/

# 方式3：使用DMG安装包
open release/灵析-0.1.0-arm64.dmg
```

### 首次配置

#### 方式1：BUC登录(推荐)
1. 启动应用后,点击小狗图标打开对话窗口
2. 点击右上角设置图标
3. 点击"登录"按钮
4. 在浏览器中完成BUC认证
5. 自动获取API密钥和用户信息

#### 方式2：手动配置
1. 启动应用后,点击小狗图标打开对话窗口
2. 点击右上角设置图标
3. 手动输入 IdeaLab API 密钥
4. 选择模型(默认 qwen-vl-max-latest)
5. 保存配置

### 基本操作

#### 打开对话窗口
- **方式1**：左键快速点击桌面小狗(< 200ms)
- **方式2**：按快捷键 `Cmd+Shift+0`

#### 移动图标位置
- 左键长按小狗图标(≥ 200ms)
- 移动鼠标到目标位置
- 释放鼠标
- 位置会自动保存

#### 退出应用
- 右键点击小狗图标
- 选择"退出"

#### 发送消息
1. 在输入框输入问题
2. 可选：勾选"📷 包含当前截图"(智能窗口截图,自动压缩)
3. 可选：勾选"📋 粘贴板截图"
4. 点击发送或按 Enter

#### 会话管理
- **新建会话**：点击左上角的"新建会话"按钮
- **切换会话**：在左侧会话列表中点击要切换的会话
- **删除会话**：在会话列表中点击会话的删除按钮
- **自动保存**：所有会话自动保存到本地

#### 其他操作
- **复制回答**：点击回答下方的复制按钮
- **查看调试信息**：打开开发者工具查看控制台

---

## 💡 产品特色

### 与传统AI的区别

| 特性 | 传统AI助手 | 灵析 |
|------|-----------|--------|
| 交互方式 | 纯文本输入 | 文本 + 屏幕截图 |
| 上下文理解 | 仅限对话历史 | 对话历史 + 视觉上下文 |
| 使用场景 | 通用问答 | 场景化辅助 |
| 视觉呈现 | 聊天窗口 | 桌面宠物 + 对话窗口 |
| 隐私控制 | 被动接收 | 主动控制 |
| 多图片支持 | 单张 | 多张(截图+剪贴板) |
| 会话管理 | 单会话 | 多会话独立管理 |
| 认证方式 | 手动输入密钥 | BUC登录 + 手动输入 |

### 核心优势

✨ **跨应用的屏幕感知**
- 智能识别当前活跃窗口
- 不限于特定应用
- 理解任何屏幕内容
- 无需手动复制粘贴
- 自动压缩优化,避免API限制

✨ **可爱的宠物形象**
- 降低使用门槛
- 增加亲和力
- 陪伴式体验
- 位置可自由调整

✨ **智能交互设计**
- 点击/长按区分明确(200ms阈值)
- 对话窗口智能定位
- 自动聚焦输入框
- 多桌面显示支持
- 流式响应实时反馈

✨ **企业级特性**
- BUC统一认证
- 多会话管理
- 会话持久化
- 自动保存机制
- 智能上下文优化

✨ **完全可控**
- 按需截图
- 用户主动触发
- 隐私友好
- 数据本地存储

---

## 🛠️ 技术栈

### 核心框架
- **框架**：Electron 28+
- **UI**：React 18 + TypeScript 5
- **状态管理**：Zustand 4.4.7
- **构建工具**：Vite 5.0.10

### UI与样式
- **样式框架**：Tailwind CSS 3.4.0
- **CSS处理**：PostCSS 8.4.32
- **Markdown渲染**：React Markdown 9.0.1
- **代码高亮**：React Syntax Highlighter 16.1.0
- **GFM支持**：remark-gfm 4.0.1

### AI服务
- **AI模型**：千问多模态模型(qwen-vl-max-latest)
- **API调用**：OpenAI TypeScript SDK 4.20.1
- **API提供方**：IdeaLab(阿里巴巴内部AI平台)

### 数据存储与日志
- **配置存储**：electron-store 8.1.0
- **日志记录**：electron-log 5.0.1

### 开发工具
- **类型检查**：TypeScript 5.3.3
- **打包工具**：Electron Builder 24.9.1
- **并发执行**：concurrently 8.2.2
- **等待服务**：wait-on 7.2.0

### 平台支持
- **当前支持**：macOS(Apple Silicon & Intel)
- **未来计划**：Windows、Linux

---

## 📋 已实现功能

### ✅ 核心功能
- [x] 桌面宠物窗口(右下角初始位置)
- [x] 点击/长按交互(基于时间判断 200ms)
- [x] 右键菜单(退出功能)
- [x] 对话窗口(智能定位在图标上方)
- [x] 全局快捷键(Cmd+Shift+0)
- [x] 智能窗口截图(自动识别当前窗口)
- [x] 图片自动压缩(缩放50% + JPEG 80%)
- [x] 粘贴板图片读取
- [x] 多图片同时发送
- [x] AI 对话(流式响应)
- [x] Markdown 渲染
- [x] 代码高亮
- [x] 配置管理(API密钥持久化)
- [x] 自动聚焦输入框
- [x] 多桌面显示(Mission Control)
- [x] 位置记忆(自动保存图标位置)

### ✅ 高级功能
- [x] BUC登录认证
- [x] 用户信息自动获取
- [x] 多会话管理
- [x] 会话历史持久化
- [x] 会话自动保存
- [x] 智能上下文管理(优先移除图片策略)
- [x] Token动态计算和优化
- [x] 命令执行功能(AI可执行系统命令)
- [x] 剪贴板监听

### ✅ 用户体验
- [x] 一键启动脚本
- [x] 调试日志输出
- [x] 错误提示友好
- [x] 图片拖拽禁用
- [x] 边界智能处理
- [x] 图片大小优化(避免API限制)
- [x] 流式响应实时显示
- [x] 会话切换流畅

---

## 🎨 界面预览

### 宠物窗口
```
                                    ┌─────────┐
                                    │         │
                                    │   🐕    │  ← 右下角(可拖动)
                                    │         │
                                    └─────────┘
```

**交互说明**：
- 左键快速点击(< 200ms)→ 打开对话框
- 左键长按(≥ 200ms)→ 拖动移动位置
- 右键点击 → 退出应用

### 对话窗口
```
┌─────────────────────────────────────────────────────┐
│  [新建会话]  🐶 灵析助手               [⚙️] [×]    │
├────────────┬────────────────────────────────────────┤
│            │                                         │
│ 会话列表    │  用户：这个API怎么用？                  │
│            │  [📷 截图显示]                          │
│ • 会话1    │                                         │
│ • 会话2    │  助手：根据您的截图,这个API...         │
│ • 会话3    │  [Markdown格式回答]                     │
│            │  [📋 复制]                              │
│            │                                         │
│            ├─────────────────────────────────────────┤
│            │  [输入框 - 自动聚焦]                    │
│            │  [📷 包含当前截图] [📋 粘贴板截图]      │
│            │                          [发送] →      │
└────────────┴─────────────────────────────────────────┘
┌─────────┐
│   🐕    │  ← 图标位置
└─────────┘
```

---

## 🔐 隐私与安全

### 数据处理原则
- ✅ 截图按需生成,用完即删
- ✅ 会话历史本地存储
- ✅ API密钥本地加密存储
- ✅ 用户完全控制数据流
- ✅ BUC认证安全可靠

### 权限说明
- **屏幕录制权限**：用于截取屏幕内容
- **粘贴板访问权限**：用于读取粘贴板截图
- **网络权限**：仅用于调用千问API和BUC认证

### 数据存储
- **配置文件**：`~/Library/Application Support/lingxi/config.json`
- **会话数据**：`~/Library/Application Support/lingxi/sessions/`
- **日志文件**：`~/Library/Logs/lingxi/`

---

## 📝 配置说明

### 必填配置
- **IdeaLab API密钥**：用于调用千问多模态模型(可通过BUC登录自动获取)

### 可选配置
- **模型选择**：默认 qwen-vl-max-latest
- **快捷键**：默认 Cmd+Shift+0
- **图标位置**：默认右下角,可自由拖动

### 配置文件位置
- macOS: `~/Library/Application Support/lingxi/config.json`

### 配置文件结构
```json
{
  "apiKey": "your-api-key",
  "model": "qwen-vl-max-latest",
  "shortcut": "Cmd+Shift+0",
  "petPosition": {
    "x": 1720,
    "y": 880
  }
}
```

---

## 🐛 故障排查

### 图标无法拖动
- 确保长按时间 ≥ 200ms
- 查看控制台是否输出 "🔄 开始拖动"

### 点击无法打开对话框
- 确保点击时间 < 200ms
- 查看控制台是否输出 "👆 点击操作"

### 截图失败
- 检查屏幕录制权限：系统偏好设置 → 安全性与隐私 → 屏幕录制
- 重启应用后重试

### API 调用失败
- 检查 API 密钥是否正确
- 尝试使用 BUC 登录重新获取密钥
- 检查网络连接
- 查看错误提示信息

### 会话无法保存
- 检查应用是否有写入权限
- 查看日志文件了解详细错误信息

### BUC登录失败
- 检查网络连接
- 确保可以访问内网
- 查看浏览器是否完成认证

---

## 🔄 版本历史

### v0.1.0 (2026-01-08)
- ✅ MVP版本完成
- ✅ 基础对话功能
- ✅ 屏幕截图功能
- ✅ 桌面宠物交互
- ✅ 多会话管理
- ✅ BUC登录认证
- ✅ 智能上下文管理
- ✅ 命令执行功能

---

## 🤝 贡献指南

本项目目前为内部工具,暂不接受外部贡献。

内部开发者请遵循以下规范：
- 使用TypeScript严格模式
- 遵循ESLint和Prettier规范
- 提交前进行类型检查
- 编写清晰的commit message

---

## 📄 许可证

内部项目,仅供阿里巴巴集团内部使用。

---

## 📞 联系方式

- **负责人**：哈雅（263321）
- **项目地址**：git@gitlab.alibaba-inc.com:haya.lhw/Lingxi.git
- **问题反馈**：通过钉钉联系负责人

---

## 🔮 未来规划

### 短期计划(Q1 2026)
- [ ] 支持更多AI模型
- [ ] 优化截图质量和压缩算法
- [ ] 增加快捷指令功能
- [ ] 改进多会话UI体验

### 中期计划(Q2 2026)
- [ ] Windows平台支持
- [ ] 宠物动画效果
- [ ] 插件系统
- [ ] 更多命令执行能力

### 长期计划(H2 2026)
- [ ] Linux平台支持
- [ ] 云端同步(可选)
- [ ] 团队协作功能
- [ ] 自定义宠物形象

---

**最后更新**：2026-01-19
