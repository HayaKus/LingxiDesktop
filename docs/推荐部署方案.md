# 推荐的更新部署方案

## 🎯 你的情况分析

你的仓库地址是: `git@gitlab.alibaba-inc.com:haya.lhw/IamDog.git`

这是**阿里内网的 GitLab 仓库**,有以下特点:
- ✅ 适合内部开发
- ❌ 外部用户无法访问
- ❌ 不适合作为公开的更新服务器

## 💡 推荐方案

### 方案1: 使用阿里云 OSS (强烈推荐)

**优点:**
- ✅ 国内访问速度快
- ✅ 稳定可靠
- ✅ 费用很低(几乎免费)
- ✅ 可以设置公共读权限
- ✅ 自动 CDN 加速

**步骤:**

#### 1. 创建 OSS Bucket

1. 登录阿里云控制台: https://oss.console.aliyun.com/
2. 点击"创建 Bucket"
3. 配置:
   - Bucket 名称: `iamdog-updates` (或你喜欢的名字)
   - 区域: 选择离用户最近的(如 华东1-杭州)
   - 读写权限: **公共读**
   - 其他保持默认

#### 2. 配置 CORS (重要!)

1. 进入 Bucket → 权限管理 → 跨域设置
2. 点击"创建规则"
3. 填写:
   ```
   来源: *
   允许 Methods: GET, HEAD
   允许 Headers: *
   暴露 Headers: *
   缓存时间: 0
   ```

#### 3. 上传 version.json

创建 `version.json` 文件:
```json
{
  "version": "0.1.1",
  "releaseDate": "2026-01-22",
  "downloadUrl": "https://iamdog-updates.oss-cn-hangzhou.aliyuncs.com/releases/lingxi-0.1.1.dmg",
  "changeLog": [
    "新增: 应用内检测更新功能",
    "优化: 改进用户界面"
  ]
}
```

上传到 OSS 根目录。

#### 4. 修改代码

打开 `electron/updateManager.ts`,修改第 29 行:

```typescript
this.updateUrl = updateUrl || 'https://iamdog-updates.oss-cn-hangzhou.aliyuncs.com/version.json';
```

**替换为你的 OSS 地址!**

#### 5. 发布流程

每次发布新版本:
```bash
# 1. 更新版本号
npm version 0.1.1

# 2. 构建应用
npm run electron:build

# 3. 上传安装包到 OSS
# 在 OSS 控制台上传 release/lingxi-0.1.1.dmg 到 releases 目录

# 4. 更新 version.json
# 修改版本号和下载链接,上传到 OSS 根目录

# 5. 测试
npm run electron:dev
# 点击"检测更新"验证
```

#### 6. 费用说明

OSS 费用非常低:
- 存储: 0.12元/GB/月 (1GB 可以存很多版本)
- 流量: 0.5元/GB (前期用户少,几乎可以忽略)
- 请求: 0.01元/万次

**预估**: 每月不到 1 元!

---

### 方案2: 如果你有公开的 GitHub 仓库

如果你打算将项目开源,可以:

1. 在 GitHub 创建公开仓库: `https://github.com/你的用户名/IamDog`
2. 推送代码到 GitHub
3. 使用 GitHub Releases 发布

**配置:**
```typescript
// electron/updateManager.ts
this.updateUrl = 'https://raw.githubusercontent.com/你的用户名/IamDog/main/version.json';
```

---

### 方案3: 使用内网服务器 (适合企业内部)

如果只在公司内部使用:

1. 在阿里内网搭建一个简单的 HTTP 服务器
2. 部署 version.json 和安装包
3. 配置内网域名

**配置:**
```typescript
// electron/updateManager.ts
this.updateUrl = 'http://your-internal-server.alibaba-inc.com/version.json';
```

---

## 🎯 我的建议

**根据你的使用场景:**

### 场景A: 应用对外发布(推荐 OSS)
- 用户在公网使用
- 需要快速稳定的下载
- → **使用阿里云 OSS** ⭐⭐⭐

### 场景B: 应用开源
- 代码公开在 GitHub
- 社区用户使用
- → **使用 GitHub Releases** ⭐⭐

### 场景C: 公司内部使用
- 只在内网使用
- 不对外开放
- → **使用内网服务器** ⭐

---

## 📋 快速开始 (OSS 方案)

### 1. 一次性配置

```bash
# 修改 electron/updateManager.ts
# 第 29 行改为你的 OSS 地址
```

### 2. 测试(本地)

```bash
# 在项目根目录启动本地服务器
python3 -m http.server 8080

# 临时修改 updateManager.ts 测试
this.updateUrl = 'http://localhost:8080/version.json';

# 启动应用测试
npm run electron:dev
```

### 3. 正式部署

1. 创建 OSS Bucket
2. 配置 CORS
3. 上传 version.json
4. 修改代码中的 URL
5. 提交代码

---

## ❓ 常见问题

### Q: OSS 需要实名认证吗?
A: 是的,需要阿里云账号和实名认证。

### Q: OSS 会很贵吗?
A: 不会,每月不到 1 元,前期几乎免费。

### Q: 能不能用 GitLab 作为更新服务器?
A: 如果是内网 GitLab,外部用户无法访问。公开的 GitLab.com 可以,但不如 OSS 稳定。

### Q: 必须用 OSS 吗?
A: 不是,但这是最稳定、最快速、最便宜的方案。

---

## 🎉 下一步

1. **决定使用哪个方案** (建议 OSS)
2. **按照文档配置** (`docs/如何配置更新功能.md` 中有 OSS 详细步骤)
3. **测试验证**
4. **发布第一个版本**

需要帮助随时问我! 🚀

---

**作者**: 哈雅 (263321)  
**日期**: 2026-01-21
